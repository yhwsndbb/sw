(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/curriculumInfo/curriculumInfo"],{"005b":function(t,e,a){"use strict";(function(t){a("36fd");o(a("66fd"));var e=o(a("c3d8"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])},"314b":function(t,e,a){"use strict";var o=a("a8e2"),s=a.n(o);s.a},a8e2:function(t,e,a){},c3d8:function(t,e,a){"use strict";a.r(e);var o=a("d9e0"),s=a("d3c0");for(var n in s)"default"!==n&&function(t){a.d(e,t,(function(){return s[t]}))}(n);a("314b");var i,r=a("f0c5"),u=Object(r["a"])(s["default"],o["b"],o["c"],!1,null,"5a494752",null,!1,o["a"],i);e["default"]=u.exports},c4a4:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){a.e("node-modules/@dcloudio/uni-ui/lib/uni-load-more/uni-load-more").then(function(){return resolve(a("5c56"))}.bind(null,a)).catch(a.oe)},s=function(){a.e("components/DataNo").then(function(){return resolve(a("9ef9"))}.bind(null,a)).catch(a.oe)},n=a("935a"),i=(n.request,n.showLoading),r=n.hideLoading,u={components:{DataNo:s,uniLoadMore:o},data:function(){return{showInput:!1,ResourcesName:"",RelationId:"",isEdit:!1,activeEdit:null,delBtnWidth:300,startX:"",showInfoText:!1,ChapterId:"",ClassId:"",ClassroomLogId:"",btnTab:0,btnnum:0,currentPage:1,pageSize:10,CoursewareList:[],playAudio:!1,TestingReportList:[],AttendInfoList:[],IssueLogList:[],Content:"",ParentId:"",LoadStartY:"",LoadStartPageY:"",loading:"",testLoading:"",testStartY:"",testStartPageY:"",AttendLoad:"",AttendStartY:"",AttendStartPageY:"",IssueLoad:"",IssueStartY:"",IssueStartPageY:""}},methods:{onIssueStart:function(t){1==t.touches.length&&(this.IssueStartY=t.touches[0].clientY,this.$data.IssueStartPageY=t.touches[0].pageY)},onIssueMove:function(t){if(1==t.touches.length){var e=t.touches[0].clientY,a=this.IssueStartY-e;t.touches[0].pageY;this.$data.IssueStartPageY<200&&(350==a||a<350?(this.$data.IssueLoad="loading",this.GetIssueLogList()):a>350&&(this.$data.IssueLoad=""))}},onAttendStart:function(t){1==t.touches.length&&(this.AttendStartY=t.touches[0].clientY,this.$data.AttendStartPageY=t.touches[0].pageY)},onAttendMove:function(t){if(1==t.touches.length){var e=t.touches[0].clientY,a=this.AttendStartY-e;this.$data.AttendStartPageY<200&&(350==a||a<350?(this.$data.AttendLoad="loading",this.GetAttendInfo()):a>350&&(this.$data.AttendLoad=""))}},onTestStart:function(t){console.log(t),1==t.touches.length&&(this.testStartY=t.touches[0].clientY,this.$data.testStartPageY=t.touches[0].pageY)},onTestMove:function(t){if(console.log(t),1==t.touches.length){var e=t.touches[0].clientY,a=this.testStartY-e;t.touches[0].pageY;this.$data.testStartPageY<200&&(350==a||a<350?(this.$data.testLoading="loading",this.GetTestingReportList()):a>350&&(this.$data.testLoading=""))}},onLoadStart:function(t){console.log(t),1==t.touches.length&&(this.LoadStartY=t.touches[0].clientY,this.$data.LoadStartPageY=t.touches[0].pageY)},onLoadMove:function(t){if(1==t.touches.length){var e=t.touches[0].clientY,a=this.LoadStartY-e;t.touches[0].pageY;this.$data.LoadStartPageY<210&&(t.stopPropagation(),t.preventDefault(),a<-80&&!this.$data.loading?(this.$data.loading="loading",this.GetCoursewareByPage()):a>310&&(this.$data.loading=""))}},AttendLoading:function(){console.log("AttendLoading");var e=this;t.showLoading({title:"加载中",success:function(){e.GetIssueLogList()}}),setTimeout((function(){t.hideLoading()}),2e3)},onIssueLoading:function(){console.log("onIssueLoading");var e=this;t.showLoading({title:"加载中",success:function(){e.GetIssueLogList()}}),setTimeout((function(){t.hideLoading()}),2e3)},onCoursLoading:function(){var e=this;t.showLoading({title:"加载中",success:function(){e.GetCoursewareByPage()}}),setTimeout((function(){t.hideLoading()}),2e3)},onTestingLoading:function(){var e=this;t.showLoading({title:"加载中",success:function(){e.GetTestingReportList()}}),setTimeout((function(){t.hideLoading()}),2e3)},SaveIssueLogStatus:function(e,a){var o=this,s=!e;t.request({method:"POST",url:"https://hk.joyfulboo.com/Campus/IssueApp/SaveIssueLogStatus",data:{IssueLogId:a,IsPublish:s},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(e){console.log(e,"修改问答状态");var a=e.data;if(1!=a.Success)return t.showToast({title:a.Message,icon:"none"}),!1;t.showToast({title:"更改状态成功",duration:3e3}),o.GetIssueLogList()}})},SaveIssueLog:function(){var e=this;t.request({method:"POST",url:"https://hk.joyfulboo.com/Campus/IssueApp/SaveIssueLog",data:{classroomLogId:this.$data.ClassroomLogId,ParentId:this.$data.ParentId,Content:this.$data.Content},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(a){console.log(a,"保存回答数据");var o=a.data;if(1!=o.Success)return t.showToast({title:o.Message,icon:"none"}),!1;t.showToast({title:"发送成功",duration:3e3}),e.$data.Content="",e.GetIssueLogList()}})},bindInputMsg:function(t){this.$data.Content=t.detail.value},onShowInput:function(t){this.$data.showInput=!0,this.$data.ParentId=t},onHideInput:function(){var t=this;setTimeout((function(){t.$data.showInput=!1}),5e3)},GetIssueLogList:function(){var e=this,a=this;t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/IssueApp/GetIssueLogList",data:{classroomLogId:this.$data.ClassroomLogId,chapterId:this.$data.ChapterId,classId:this.$data.ClassId,currentPage:1,pageSize:10},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o,"问答列表");var s=o.data;if(1!=s.Success)return t.showToast({title:s.Message,icon:"none"}),!1;e.$data.IssueLogList=o.data.Data,setTimeout((function(){a.$data.IssueLoad=""}),2e3)}})},GetAttendInfo:function(){var e=this,a=this;t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/AttendApp/GetAttendInfo",data:{classroomLogId:this.$data.ClassroomLogId,attendStatus:"1",studentName:""},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o,"考勤列表");var s=o.data;if(1!=s.Success)return t.showToast({title:s.Message,icon:"none"}),!1;e.$data.AttendInfoList=s.Data,setTimeout((function(){a.$data.AttendLoad=""}),2e3)}})},onTestInfo:function(e){t.navigateTo({url:"../testDetails/testDetails?TestingLogId="+e})},addResource:function(){t.navigateTo({url:"../addResource/addResource?ChapterId=".concat(this.$data.ChapterId,"&ClassId=").concat(this.$data.ClassId)})},inputVal:function(t){console.log(t),this.$data.RenameName=t.detail.value},RenameCourseware:function(){var e=this;t.request({method:"POST",url:"https://hk.joyfulboo.com/Campus/CoursewareApp/RenameCourseware",data:{RelationId:this.$data.RelationId,RenameName:this.$data.RenameName,ClassId:this.$data.ClassId},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(a){console.log(a);var o=a.data;if(1!=o.Success)return t.showToast({title:o.Message,icon:"none"}),!1;t.showToast({title:"修改成功",duration:3e3}),e.$data.isEdit=!1,e.$data.activeEdit=null,e.GetCoursewareByPage()}})},unhide:function(){this.$data.isEdit=!1},onEdit:function(t){this.$data.RelationId=t,this.$data.isEdit=!0},onDel:function(e){var a=this,o=this;wx.showModal({title:"提示",content:"确认要删除此课件吗？",success:function(s){s.confirm?t.request({method:"POST",url:"https://hk.joyfulboo.com/Campus/CoursewareApp/DeleteCourseware",data:{ResourcesId:e,ChapterId:a.$data.ChapterId,ClassId:a.$data.ClassId},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(e){console.log(e);var a=e.data;if(1!=a.Success)return t.showToast({title:a.Message,icon:"none"}),!1;t.showToast({title:"删除成功",duration:3e3}),o.GetCoursewareByPage()}}):s.cancel&&console.log("用户点击取消")}})},UploadCourseware:function(){var e=this;t.navigateTo({url:"../uploadFile/uploadFile?name=https://hk.joyfulboo.com/Campus/CoursewareApp/UploadCourseware&classId=".concat(e.$data.ClassId,"&chapterId=").concat(e.$data.ChapterId)})},onPanStart:function(t){1==t.touches.length&&(this.startX=t.touches[0].clientX)},onPanMove:function(t){if(1==t.touches.length){var e=t.touches[0].clientX,a=this.startX-e,o=this.delBtnWidth,s=t.currentTarget.dataset.index;110==a||a<110?(t.stopPropagation(),t.preventDefault(),this.$data.activeEdit=null):a>110&&(t.stopPropagation(),t.preventDefault(),this.$data.activeEdit=s,a>=o&&(this.$data.activeEdit=s))}},OnopenFile:function(e,a){var o=this;5==a?t.navigateTo({url:"../testInfo/testInfo?ResourcesId="+e}):t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/CoursewareApp/PreviewCoursewareOnline",data:{resourcesId:e,isCurrent:!1,classroomLogId:""},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(s){console.log(s);var n=s.data;if(1!=n.Success)return t.showToast({title:n.Message,icon:"none"}),!1;if(1==a)i("加载中"),wx.downloadFile({url:n.Data,success:function(t){console.log(t);var e=t.tempFilePath;wx.openDocument({filePath:e,success:function(t){r()}})}});else if(2==a){var u=[];u.push(n.Data),console.log(u),t.previewImage({urls:u,current:u[0]})}else if(3==a)t.navigateTo({url:"../videoMP/videoMP?videoSrc="+n.Data});else if(4==a)wx.downloadFile({url:n.Data,success:function(a){console.log(a);var o=a.tempFilePath;wx.getFileSystemManager().readFile({filePath:o,encoding:"utf-8",success:function(a){console.log("readFile="+a),console.log(a);new RegExp("/n","g");var o=a.data.replace(/\n/g,"<br/>");t.setStorageSync("txtInfo",o),t.navigateTo({url:"../txt/txt?id="+e}),r()}})}});else if(6==a){var c=JSON.stringify(n.Data);t.navigateTo({url:"../videoMP/videoMP?videoArr="+c})}else if(7==a){o.$data.playAudio=!o.$data.playAudio;var d=o.$data.playAudio;d?wx.playBackgroundAudio({dataUrl:n.Data,title:"",coverImgUrl:""}):wx.stopBackgroundAudio()}}})},GetCoursewareByPage:function(){var e=this,a=this;t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/CoursewareApp/GetCoursewareByPage",data:{chapterId:this.$data.ChapterId,currentPage:this.$data.currentPage,pageSize:this.$data.pageSize,classId:this.$data.ClassId},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o,"课件列表");var s=o.data;if(1!=s.Success)return t.showToast({title:s.Message,icon:"none"}),!1;e.$data.CoursewareList=s.Data,setTimeout((function(){a.$data.loading="",a.$data.activeEdit=null}),2e3)}})},GetTestingReportList:function(){var e=this,a=this;t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/MessageLogApp/GetTestingReportList",data:{chapterId:this.$data.ChapterId,classroomLogId:this.$data.ClassroomLogId},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o);var s=o.data;if(1!=s.Success)return t.showToast({title:s.Message,icon:"none"}),!1;e.$data.TestingReportList=s.Data,setTimeout((function(){a.$data.testLoading=""}),2e3)}})},change:function(t){this.btnnum=t,0==this.btnnum?this.GetCoursewareByPage():1==this.btnnum&&""!==this.$data.ClassroomLogId?this.GetTestingReportList():2==this.btnnum&&""!==this.$data.ClassroomLogId?this.GetIssueLogList():3==this.btnnum&&""!==this.$data.ClassroomLogId&&this.GetAttendInfo()},changeTab:function(t){this.btnTab=t},timeChangeover:function(t){var e,a=6e4,o=60*a,s=24*o,n=30*s,i=(new Date).getTime();t=t.replace(/-/g,"/");var r=Date.parse(t),u=i-r;if(!(u<0)){var c=u/n,d=u/(7*s),l=u/s,h=u/o,g=u/a;return e=c>=1?c<=12?parseInt(c)+"月前":parseInt(c/12)+"年前":d>=1?parseInt(d)+"周前":l>=1?parseInt(l)+"天前":h>=1?parseInt(h)+"小时前":g>=1?parseInt(g)+"分钟前":"刚刚",e}},callMethods:function(t){var e=this;switch(t.M[0].M){case"pong":console.log("Pong防止nginx中断连接");break;case"xcxMessage":console.log(t.M[0].A[0]);var a=t.M[0].A[0];0==a.MessageType&&e.GetIssueLogList();break;default:console.log(t)}}},onLoad:function(t){var e=this;console.log(t),this.$data.ClassId=t.ClassId,this.$data.ChapterId=t.ChapterId,this.$data.ClassroomLogId=t.ClassroomLogId,this.$data.ChapterName=t.ChapterName,wx.setNavigationBarTitle({title:t.ChapterName}),this.GetCoursewareByPage();var a=setInterval((function(){""!==e.$data.ClassroomLogId&&(console.log("2223"),e.GetAttendInfo(),e.GetIssueLogList(),e.GetTestingReportList(),clearInterval(a))}),1e3);wx.onSocketMessage((function(t){try{var a=String(t.data).replace(recordString,"");if(a.indexOf("{}")>-1&&(a=a.replace("{}","")),0!=a.length){var o=JSON.parse(a);console.log("server return :",o),"M"in o&&o.M.length>0&&e.callMethods(o)}}catch(s){console.log("异常："+s),console.log("收到服务器内容："+t.data)}}))},onShow:function(){this.GetCoursewareByPage()}};e.default=u}).call(this,a("543d")["default"])},d3c0:function(t,e,a){"use strict";a.r(e);var o=a("c4a4"),s=a.n(o);for(var n in o)"default"!==n&&function(t){a.d(e,t,(function(){return o[t]}))}(n);e["default"]=s.a},d9e0:function(t,e,a){"use strict";var o,s=function(){var t=this,e=t.$createElement,a=(t._self._c,{contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:""}),o={contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:""},s={contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:""},n=t.__map(t.IssueLogList,(function(e,a){var o=t.timeChangeover(e.CreateDatetime);return{$orig:t.__get_orig(e),m0:o}})),i={contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:""};t.$mp.data=Object.assign({},{$root:{a0:a,a1:o,a2:s,l0:n,a3:i}})},n=[];a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){return o}))}},[["005b","common/runtime","common/vendor"]]]);