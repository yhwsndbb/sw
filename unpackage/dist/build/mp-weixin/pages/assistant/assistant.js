(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/assistant/assistant"],{"2ba6":function(e,t,a){},"33a8":function(e,t,a){"use strict";a.r(t);var s=a("f79a"),n=a.n(s);for(var o in s)"default"!==o&&function(e){a.d(t,e,(function(){return s[e]}))}(o);t["default"]=n.a},"3ef1":function(e,t,a){"use strict";var s=a("2ba6"),n=a.n(s);n.a},"47a7":function(e,t,a){"use strict";(function(e){a("36fd");s(a("66fd"));var t=s(a("ed34"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("543d")["createPage"])},"953d":function(e,t,a){"use strict";var s,n=function(){var e=this,t=e.$createElement,a=(e._self._c,{contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:""});e.$mp.data=Object.assign({},{$root:{a0:a}})},o=[];a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return s}))},ed34:function(e,t,a){"use strict";a.r(t);var s=a("953d"),n=a("33a8");for(var o in n)"default"!==o&&function(e){a.d(t,e,(function(){return n[e]}))}(o);a("3ef1");var i,r=a("f0c5"),u=Object(r["a"])(n["default"],s["b"],s["c"],!1,null,"8fad2092",null,!1,s["a"],i);t["default"]=u.exports},f79a:function(e,t,a){"use strict";(function(e){function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){a.e("node-modules/@dcloudio/uni-ui/lib/uni-load-more/uni-load-more").then(function(){return resolve(a("5c56"))}.bind(null,a)).catch(a.oe)},o=function(){a.e("node-modules/@dcloudio/uni-ui/lib/uni-search-bar/uni-search-bar").then(function(){return resolve(a("b501"))}.bind(null,a)).catch(a.oe)},i=a("935a"),r=i.request,u=a("15c5"),c=(getApp(),e.getStorageSync("UserInfo")),d=c.UserNo,g=new u.signalR,l={components:{uniSearchBar:o,uniLoadMore:n},data:function(){var e;return e={DataListNo:!1,activeEdit:null,dateIndex:null,sVal:"",schooltime:"",messageList:[],PageSize:10,CurrentPage:1,TotalPages:1,SearchValue:""},s(e,"TotalPages",1),s(e,"delBtnWidth",300),s(e,"startX",""),s(e,"ReadCount",""),s(e,"messageLoad",""),s(e,"messageY",""),e},methods:{messageListLoading:function(){var t=this;e.showLoading({title:"加载中",success:function(){t.$data.messageList=[],t.GetMessageLogList()}}),setTimeout((function(){e.hideLoading()}),2e3)},messageStart:function(e){console.log(e),1==e.touches.length&&(this.messageY=e.touches[0].clientY)},messageMove:function(e){if(console.log(e),1==e.touches.length){var t=e.touches[0].clientY,a=(e.touches[0].clientX,e.touches[0].pageY,this.messageY-t);this.messageY<=100?455==a||a<455?(this.$data.messageLoad="loading",this.GetMessageLogList()):a>455&&(this.$data.messageLoad=""):this.$data.messageLoad=""}},SearchVal:function(e){this.$data.SearchValue=e.value,this.$data.messageList=[],this.GetMessageLogList(),""==e.value&&(this.$data.SearchValue=e.value,this.$data.messageList=[],this.GetMessageLogList())},confirmSearch:function(){this.$data.messageList=[],this.GetMessageLogList()},DeleteMessage:function(t,a,s){var n=this;r({url:"/MessageLogApp/DeleteMessage",data:{messageLogId:t}}).then((function(t){console.log(t);var o=t.data;if(1!=o.Success)return e.showToast({title:o.Message,icon:"none"}),!1;n.$data.messageList[a].MessageList.splice(s,1),n.$data.activeEdit=null,e.showToast({title:"删除成功"})}))},SaveMessageReadStatus:function(t,a,s,n){var o=this;console.log(this.$data.CurrentPage);var i=!a;e.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/MessageLogApp/SaveMessageReadStatus",data:{messageLogId:t,isRead:i},header:{"content-type":"application/json",Authorization:e.getStorageSync("token")},success:function(t){console.log(t,"保存消息阅读状态");var a=t.data;if(1!=a.Success)return e.showToast({title:a.Message,icon:"none"}),!1;o.$data.messageList[s].MessageList[n].IsRead=!o.$data.messageList[s].MessageList[n].IsRead,o.$data.activeEdit=null,o.GetMessageReadCount()}})},SaverInfoStatus:function(t,a){var s=this;console.log(this.$data.CurrentPage);var n=!a;e.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/MessageLogApp/SaveMessageReadStatus",data:{messageLogId:t,isRead:n},header:{"content-type":"application/json",Authorization:e.getStorageSync("token")},success:function(t){console.log(t,"保存消息阅读状态");var a=t.data;if(1!=a.Success)return e.showToast({title:a.Message,icon:"none"}),!1;s.GetMessageReadCount()}})},GetTestPaperInfo:function(t,a,s,n,o,i){4===t||n||(this.SaverInfoStatus(s,n,o,i),this.$data.messageList[o].MessageList[i].IsRead||(this.$data.messageList[o].MessageList[i].IsRead=!0)),2==t?e.navigateTo({url:"../referat/referat?MessageLogId="+s}):4==t?e.navigateTo({url:"../MakeInfo/MakeInfo?ClassroomLogId="+a}):3==t&&e.navigateTo({url:"../testDetails/testDetails?TestingLogId="+a})},GetMessageLogList:function(){var t=this,a=this;e.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/MessageLogApp/GetMessageLogList",data:{currentPage:a.$data.CurrentPage,pageSize:a.$data.PageSize,searchValue:a.$data.SearchValue},header:{"content-type":"application/json",Authorization:e.getStorageSync("token")},success:function(s){if(console.log(s),s.data.Success){var n=Math.ceil(s.data.RecordCount/a.$data.PageSize);a.$data.TotalPages=n;var o=a.$data.messageList,i=a.$data.CurrentPage;if(1==a.$data.CurrentPage){for(var r in o=s.data.Data,i=1,o){var u=o[r];for(var c in u.MessageList){var d=u.MessageList[c];t.$data.ReadCount=0,d.IsRead||(t.$data.ReadCount=t.$data.ReadCount+1),d.Content&&(d.Content=JSON.parse(d.Content)),d.CreateDatetime&&(4==d.MessageType?(d.CreateDatetime=d.CreateDatetime.substring(5,16),d.CreateDatetime=d.CreateDatetime.replace("-","月"),d.CreateDatetime=d.CreateDatetime.replace(" ","日　")):(d.CreateDatetime=d.CreateDatetime.substring(5,10),d.CreateDatetime=d.CreateDatetime.replace("-","月"),d.CreateDatetime=d.CreateDatetime+"日"))}}e.stopPullDownRefresh()}else{var g=s.data.Data;for(var l in g){var h=g[l];for(var f in h.MessageList){var m=h.MessageList[f];m.IsRead||(t.$data.ReadCount=t.$data.ReadCount+1),m.Content&&(m.Content=JSON.parse(m.Content)),m.CreateDatetime&&(4==m.MessageType?(m.CreateDatetime=m.CreateDatetime.substring(5,16),m.CreateDatetime=m.CreateDatetime.replace("-","月"),m.CreateDatetime=m.CreateDatetime.replace(" ","日　")):(m.CreateDatetime=m.CreateDatetime.substring(5,10),m.CreateDatetime=m.CreateDatetime.replace("-","月"),m.CreateDatetime=m.CreateDatetime+"日"))}}o=o.concat(g),i+=1}a.messageList=o,a.$data.CurrentPage=i,a.$data.activeEdit=null,0==a.messageList.length?a.$data.DataListNo=!0:a.$data.DataListNo=!1,setTimeout((function(){a.$data.messageLoad=""}),2e3)}}})},onSearchValue:function(e){this.$data.SearchValue=e.value,this.GetMessageLogList(),this.$forceUpdate()},onPanStart:function(e){1==e.touches.length&&(this.startX=e.touches[0].clientX)},onPanMove:function(e){if(1==e.touches.length){var t=e.touches[0].clientX,a=(e.touches[0].clientY,this.startX-t),s=this.delBtnWidth,n=e.currentTarget.dataset.index,o=e.currentTarget.dataset.createdate;100==a||a<100?(this.$data.activeEdit=null,this.$data.dateIndex=null):a>100&&(this.$data.activeEdit=n,this.$data.dateIndex=o,a>=s&&(this.$data.activeEdit=n,this.$data.dateIndex=o))}},GetMessageReadCount:function(){var t="";e.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/MessageLogApp/GetMessageReadCount",data:{},header:{"content-type":"application/json",Authorization:e.getStorageSync("token")},success:function(a){console.log(a);var s=a.data;if(1!=s.Success)return e.showToast({title:s.Message,icon:"none"}),!1;t=s.Data.toString(),e.setTabBarBadge({index:0,text:t})}})}},onLoad:function(){this.GetMessageLogList(),this.$forceUpdate(),this.GetMessageReadCount();var t=e.getStorageSync("token");t||e.navigateTo({url:"/pages/login/login"})},onShow:function(){this.$forceUpdate(),this.GetMessageReadCount()},onPullDownRefresh:function(){console.log("eeee"),this.$data.CurrentPage=1,this.GetMessageLogList()},onReachBottom:function(){this.$data.CurrentPage<this.$data.TotalPages?(this.$data.CurrentPage++,this.GetMessageLogList()):e.showToast({title:"没有更多数据了",icon:"none"})},onReady:function(){g.connection("https://hk.joyfulboo.com",d,null)}};t.default=l}).call(this,a("543d")["default"])}},[["47a7","common/runtime","common/vendor"]]]);