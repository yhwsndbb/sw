(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"0b0c":function(t,e,o){"use strict";(function(t){o("36fd");a(o("66fd"));var e=a(o("d483"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},"4f3e":function(t,e,o){"use strict";o.r(e);var a=o("c251"),s=o.n(a);for(var n in a)"default"!==n&&function(t){o.d(e,t,(function(){return a[t]}))}(n);e["default"]=s.a},"6e3e":function(t,e,o){"use strict";var a=o("bbae"),s=o.n(a);s.a},9620:function(t,e,o){"use strict";var a,s=function(){var t=this,e=t.$createElement,o=(t._self._c,t.CurrentClass.StartTime.substring(11,16)),a=t.CurrentClass.EndTime.substring(11,16),s={contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:""},n={contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:""},i=t.__map(t.IssueLogList,(function(e,o){var a=t.timeChangeover(e.CreateDatetime);return{$orig:t.__get_orig(e),m0:a}})),r=t.formatSeconds(t.RecordDuration);t.$mp.data=Object.assign({},{$root:{g0:o,g1:a,a0:s,a1:n,l0:i,m1:r}})},n=[];o.d(e,"b",(function(){return s})),o.d(e,"c",(function(){return n})),o.d(e,"a",(function(){return a}))},bbae:function(t,e,o){},c251:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=function(){o.e("node-modules/@dcloudio/uni-ui/lib/uni-load-more/uni-load-more").then(function(){return resolve(o("5c56"))}.bind(null,o)).catch(o.oe)},s=function(){o.e("components/DataNo").then(function(){return resolve(o("9ef9"))}.bind(null,o)).catch(o.oe)},n=o("935a"),i=(n.request,n.showLoading),r=n.hideLoading,u={components:{DataNo:s,uniLoadMore:a},data:function(){return{ClassroomLogId:"",ClassStats:"",videoContextIndex:"",videoUrl:"https://zhks-1252354869.cos.ap-guangzhou.myqcloud.com/Video/vga_2020_04_23_152116.mp4",CurrentClass:{},ResourcesName:"",RelationId:"",ChapterId:"",ClassId:"",isEdit:!1,activeEdit:null,ChapterIndex:null,delBtnWidth:300,startX:"",playAudio:!1,status:1,btnTab:0,btnnum:0,CoursewareList:[],RenameName:"",IssueLogList:[],showInput:!1,Content:"",ParentId:"",RecordCount:0,IsLive:"",IsRecord:"",RecordDuration:"00:00:00",IsPlayURL:"",LiveInfo:1,CoursewareY:"",CoursewareLoad:"",IssueLogLoad:"",IssueLogY:"",CoursewarepageY:"",buttonClicked:!1,translateInfo:0,saveTransInfo:""}},methods:{callMethods:function(t){var e=this;switch(t.M[0].M){case"pong":console.log("Pong防止nginx中断连接");break;case"xcxMessage":console.log(t.M[0].A[0]);var o=t.M[0].A[0];12==o.MessageType?e.GetCurrentClass():0==o.MessageType&&e.GetIssueLogList();break;default:console.log(t)}},onIssueLogStart:function(t){console.log(t),1==t.touches.length&&(this.IssueLogY=t.touches[0].clientY)},onIssueLogMove:function(t){if(console.log(t),1==t.touches.length){var e=t.touches[0].clientY,o=this.IssueLogY-e;110==o||o<110?(this.$data.IssueLogLoad="loading",this.GetCoursewareList()):o>110&&(this.$data.IssueLogLoad="")}},onLoadStart:function(t){console.log(t),1==t.touches.length&&(this.CoursewareY=t.touches[0].clientY,this.CoursewarepageY=t.touches[0].pageY,console.log(this.CoursewarepageY))},onLoadMove:function(t){if(console.log(t),1==t.touches.length){var e=t.touches[0].clientY,o=this.CoursewareY-e;this.CoursewarepageY<=350?110==o||o<110?(this.$data.CoursewareLoad="loading",this.GetCoursewareList()):o>110&&(this.$data.CoursewareLoad=""):this.$data.CoursewareLoad=""}},clickLoadMore:function(t){console.log(t)},IssueLoading:function(){var e=this;t.showLoading({title:"加载中",success:function(){e.GetIssueLogList()}}),setTimeout((function(){t.hideLoading()}),2e3)},CoursewareLoading:function(){var e=this;t.showLoading({title:"加载中",success:function(){e.GetCoursewareList()}}),setTimeout((function(){t.hideLoading()}),2e3)},SwitchLive:function(e){0!=this.$data.IsLive?(this.$data.LiveInfo=0==this.$data.LiveInfo?1:0,e=this.$data.LiveInfo,1==e?this.GetCPClassLiveInfo():0==e&&this.GetHKClassLiveInfo(),console.log(e)):t.showToast({title:"请先开启直播",icon:"none"})},switchTranslate:function(e){var o=this;this.$data.saveTransInfo!==e&&(0!=this.$data.IsLive?(this.$data.translateInfo=e,this.$data.saveTransInfo=e,t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/EquipmentApp/SetChannel",data:{switchChannel:e},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(e){var a=e.data;if(1!=a.Success)return"[-1]"!=a.Message&&(t.showToast({title:a.Message,icon:"none"}),!1);o.$data.IsPlayURL=a.Data.url}})):t.showToast({title:"请先开启直播",icon:"none"}))},OpenVideoPlayer:function(){var e=this;this.$data.IsRecord=0==this.$data.IsRecord?1:0,console.log(this.$data.IsRecord),t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/EquipmentApp/OpenVideoPlayer",data:{deviceState:this.$data.IsRecord},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o,"开启/关闭录播");var a=o.data;if(1!=a.Success)return"[-1]"!=a.Message&&(t.showToast({title:a.Message,icon:"none"}),!1);e.GetVideoStatus()}})},SetCPLiveStatus:function(){var e=this;this.$data.IsLive=0==this.$data.IsLive?1:0,console.log(this.$data.IsLive),t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/EquipmentApp/SetCPLiveStatus",data:{deviceState:this.$data.IsLive},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o,"设置直播状态");var a=o.data;if(1!=a.Success)return"[-1]"!=a.Message&&(t.showToast({title:a.Message,icon:"none"}),!1);e.GetCPClassLiveInfo(),e.GetVideoStatus()}})},GetVideoStatus:function(){var e=this,o="",a=this;t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/EquipmentApp/GetVideoStatus",data:{},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(s){console.log(s,"获取直播状态");var n=s.data;if(1!=n.Success)return"[-1]"!=n.Message&&(t.showToast({title:n.Message,icon:"none"}),!1);e.$data.IsLive=n.Data.IsLive,e.$data.IsRecord=n.Data.IsRecord,e.$data.RecordDuration=n.Data.RecordDuration,1==e.$data.IsRecord?o=setTimeout((function(){a.GetVideoStatus()}),1e3):clearTimeout(o)}})},requestFullScreen:function(){0!=this.$data.IsLive?this.$data.videoContextIndex.requestFullScreen({direction:90}):t.showToast({title:"直播未开启，无法全屏",icon:"none"})},GetCPClassLiveInfo:function(){var e=this;t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/EquipmentApp/GetCPClassLiveInfo",data:{protocol:"http"},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o,"直播地址CP");var a=o.data;if(1!=a.Success)return"[-1]"!=a.Message&&(t.showToast({title:a.Message,icon:"none"}),!1);e.$data.IsPlayURL=a.Data.url}})},GetHKClassLiveInfo:function(){var e=this;t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/EquipmentApp/GetHKClassLiveInfo",data:{protocol:"http"},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o,"直播地址HK");var a=o.data;if(1!=a.Success)return"[-1]"!=a.Message&&(t.showToast({title:a.Message,icon:"none"}),!1);e.$data.IsPlayURL=a.Data.url}})},SaveIssueLogStatus:function(e,o){var a=this,s=!e;t.request({method:"POST",url:"https://hk.joyfulboo.com/Campus/IssueApp/SaveIssueLogStatus",data:{IssueLogId:o,IsPublish:s},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(e){console.log(e,"修改问答状态");var o=e.data;if(1!=o.Success)return t.showToast({title:o.Message,icon:"none"}),!1;t.showToast({title:"更改状态成功",duration:3e3}),a.GetIssueLogList()}})},SaveIssueLog:function(){var e=this;t.request({method:"POST",url:"https://hk.joyfulboo.com/Campus/IssueApp/SaveIssueLog",data:{classroomLogId:this.$data.CurrentClass.ClassroomLogId,ParentId:this.$data.ParentId,Content:this.$data.Content},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o,"保存回答数据");var a=o.data;if(1!=a.Success)return t.showToast({title:a.Message,icon:"none"}),!1;t.showToast({title:"发送成功",duration:3e3}),e.$data.Content="",e.GetIssueLogList()}})},bindInputMsg:function(t){this.$data.Content=t.detail.value},onShowInput:function(t){this.$data.showInput=!0,this.$data.ParentId=t},onHideInput:function(){var t=this;setTimeout((function(){t.$data.showInput=!1}),5e3)},GetIssueLogList:function(){var e=this,o=this;t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/IssueApp/GetIssueLogList",data:{classroomLogId:this.$data.CurrentClass.ClassroomLogId,chapterId:this.$data.CurrentClass.ChapterId,classId:this.$data.CurrentClass.TeachClassId,currentPage:1,pageSize:10},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(a){console.log(a,"问答列表");var s=a.data;if(1!=s.Success)return t.showToast({title:s.Message,icon:"none"}),!1;e.$data.IssueLogList=s.Data,e.$data.RecordCount=s.RecordCount,setTimeout((function(){o.$data.IssueLogLoad=""}),2e3)}})},AddTestingLog:function(e,o){var a=this;wx.showModal({title:"提示",content:"确定要发起测试?",success:function(s){s.confirm?t.request({method:"POST",data:{ChapterId:e,ResourcesId:o,ClassId:a.$data.CurrentClass.TeachClassId,ClassroomLogId:a.$data.CurrentClass.ClassroomLogId},url:"https://hk.joyfulboo.com/Campus/TestingApp/AddTestingLog",header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(t){console.log(t);t.data;a.GetCoursewareList()}}):s.cancel&&console.log("用户点击取消")}})},addResource:function(e,o){t.navigateTo({url:"../addResource/addResource?ChapterId=".concat(o,"&ClassId=").concat(e)})},inputVal:function(t){console.log(t),this.$data.RenameName=t.detail.value},GetCoursewareList:function(){var e=this,o=this;t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/CoursewareApp/GetCoursewareList",data:{chapterId:this.$data.CurrentClass.ChapterId,curriculumCode:this.$data.CurrentClass.CurriculumCode,classId:this.$data.CurrentClass.TeachClassId},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(a){console.log(a);var s=a.data;if(1!=s.Success)return t.showToast({title:s.Message,icon:"none"}),!1;e.$data.CoursewareList=s.Data,e.$data.activeEdit=null,setTimeout((function(){o.$data.CoursewareLoad=""}),2e3)}})},goAttendInfo:function(e,o){2==this.$data.ClassStats&&t.navigateTo({url:"../AttendInfo/AttendInfo?ClassroomLogId=".concat(e,"&attendStatus=").concat(o)})},GetAttentByClassroomLog:function(){t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/AttendApp/GetAttentByClassroomLog",data:{classroomLogId:this.$data.CurrentClass.ClassroomLogId},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(e){console.log(e);var o=e.data;if(1!=o.Success)return t.showToast({title:o.Message,icon:"none"}),!1}})},SetClassOverOrUp:function(){var e=this,o=e.$data.ClassStats,a=e.$data.ClassroomLogId,s="",n="";null!=a&&""!=a&&void 0!=a?(2==o?(s="close",n="确定要下课吗？"):(s="open",n="确定要上课吗？"),wx.showModal({title:"提示",content:n,success:function(o){o.confirm?t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/ClassroomLogApp/SetClassOverOrUp",data:{classroomLogId:a,deviceState:s},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o);var a=o.data;if(1!=a.Success)return t.showToast({title:a.Message,icon:"none"}),!1;t.showToast({title:"请求成功",icon:"none"}),e.GetCurrentClass()}}):o.cancel&&console.log("用户点击取消")}})):t.showToast({title:"课程还未开始",icon:"none"})},RenameCourseware:function(){var e=this;t.request({method:"POST",url:"https://hk.joyfulboo.com/Campus/CoursewareApp/RenameCourseware",data:{RelationId:e.$data.RelationId,RenameName:e.$data.RenameName,ClassId:e.$data.CurrentClass.TeachClassId},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o);var a=o.data;if(1!=a.Success)return t.showToast({title:a.Message,icon:"none"}),!1;t.showToast({title:"修改成功",duration:3e3}),e.$data.isEdit=!1,e.GetCoursewareList()}})},unhide:function(){this.$data.isEdit=!1},onEdit:function(t){this.$data.RelationId=t,this.$data.isEdit=!0},onShare:function(e,o){var a=this;o=!o,t.request({method:"POST",url:"https://hk.joyfulboo.com/Campus/CoursewareApp/SaveCoursewareShare",data:{RelationId:e,ClassId:a.$data.CurrentClass.TeachClassId,IsShare:o,IsCurrent:!0,ClassroomLogId:a.$data.CurrentClass.ClassroomLogId},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(e){console.log(e);var o=e.data;if(1!=o.Success)return t.showToast({title:o.Message,icon:"none"}),!1;t.showToast({title:"分享成功"}),a.GetCoursewareList()}})},onDel:function(e,o){var a=this;wx.showModal({title:"提示",content:"确认要删除此课件吗？",success:function(s){s.confirm?t.request({method:"POST",url:"https://hk.joyfulboo.com/Campus/CoursewareApp/DeleteCourseware",data:{ResourcesId:e,ChapterId:o,ClassId:a.$data.CurrentClass.TeachClassId},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(e){console.log(e);var o=e.data;if(1!=o.Success)return t.showToast({title:o.Message,icon:"none"}),!1;t.showToast({title:"删除成功",duration:3e3}),a.GetCoursewareList()}}):s.cancel&&(console.log("用户点击取消"),a.$data.activeEdit=null)}})},onPanStart:function(t){1==t.touches.length&&(this.startX=t.touches[0].clientX)},onPanMove:function(t){if(1==t.touches.length){var e=t.touches[0].clientX,o=this.startX-e,a=this.delBtnWidth,s=t.currentTarget.dataset.index,n=t.currentTarget.dataset.chapter;110==o||o<110?this.$data.activeEdit=null:o>110&&(this.$data.activeEdit=s,this.$data.ChapterIndex=n,o>=a&&(this.$data.activeEdit=s,this.$data.ChapterIndex=n))}},OnopenFile:function(e,o,a,s){console.log("打开文件");var n=this;5==o?t.request({method:"GET",data:{testingLogId:a},url:"https://hk.joyfulboo.com/Campus/TestingApp/GetTestingStatus",header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o);var i=o.data;if(1!=i.Success)return n.AddTestingLog(s,e),!1;t.navigateTo({url:"../underTest/underTest?TestingLogId="+a}),1==i.Data||n.AddTestingLog(s,e)}}):t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/CoursewareApp/PreviewCoursewareOnline",data:{resourcesId:e,isCurrent:!0,classroomLogId:n.$data.CurrentClass.ClassroomLogId},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(a){console.log(a);var s=a.data;if(1!=s.Success)return t.showToast({title:s.Message,icon:"none"}),!1;if(1==o)i("加载中"),wx.downloadFile({url:s.Data,success:function(t){console.log(t);var e=t.tempFilePath;wx.openDocument({filePath:e,success:function(t){r()}})}});else if(2==o){var u=[];u.push(s.Data),console.log(u),t.previewImage({urls:u,current:u[0]})}else if(3==o)t.navigateTo({url:"../videoMP/videoMP?videoSrc="+s.Data});else if(4==o)wx.downloadFile({url:s.Data,success:function(o){console.log(o);var a=o.tempFilePath;wx.getFileSystemManager().readFile({filePath:a,encoding:"utf-8",success:function(o){console.log("readFile="+o),console.log(o);new RegExp("/n","g");var a=o.data.replace(/\n/g,"<br/>");t.setStorageSync("txtInfo",a),t.navigateTo({url:"../txt/txt?id="+e}),r()}})}});else if(6==o){var c=JSON.stringify(s.Data);t.navigateTo({url:"../videoMP/videoMP?videoArr="+c})}else if(7==o){n.$data.playAudio=!n.$data.playAudio;var l=n.$data.playAudio;l?wx.playBackgroundAudio({dataUrl:s.Data,title:"",coverImgUrl:""}):wx.stopBackgroundAudio()}}})},GetCurrentClass:function(){var e=this;t.request({method:"GET",url:"https://hk.joyfulboo.com/Campus/ClassroomLogApp/GetCurrentClass",data:{},header:{"content-type":"application/json",Authorization:t.getStorageSync("token")},success:function(o){console.log(o,"当前课堂信息");var a=o.data;if(1!=a.Success)return t.showToast({title:a.Message,icon:"none"}),!1;e.$data.CurrentClass=a.Data,e.$data.ClassroomLogId=a.Data.ClassroomLogId,e.$data.ClassStats=a.Data.ClassStatus,e.GetCoursewareList(),e.GetIssueLogList()}})},change:function(t){this.btnnum=t,console.log(this.btnnum),0==this.btnnum?this.GetCoursewareList():1==this.btnnum?this.GetIssueLogList():this.switchTranslate(this.$data.translateInfo)},changeTab:function(t){this.btnTab=t,console.log(this.btnTab)},timeChangeover:function(t){var e,o=6e4,a=60*o,s=24*a,n=30*s,i=(new Date).getTime();t=t.replace(/-/g,"/");var r=Date.parse(t),u=i-r;if(!(u<0)){var c=u/n,l=u/(7*s),d=u/s,h=u/a,g=u/o;return e=c>=1?c<=12?parseInt(c)+"月前":parseInt(c/12)+"年前":l>=1?parseInt(l)+"周前":d>=1?parseInt(d)+"天前":h>=1?parseInt(h)+"小时前":g>=1?parseInt(g)+"分钟前":"刚刚",e}},formatSeconds:function(t){var e=parseInt(t),o=0,a=0;e>60&&(o=parseInt(e/60),e=parseInt(e%60),o>60&&(a=parseInt(o/60),o=parseInt(o%60)));var s=(parseInt(a)>9?parseInt(a):"0"+parseInt(a))+":"+(parseInt(o)>9?parseInt(o):"0"+parseInt(o))+":"+(parseInt(e)>9?parseInt(e):"0"+parseInt(e));return s}},onLoad:function(){var e=this,o=wx.createVideoContext("myPlayer");this.$data.videoContextIndex=o,this.$data.videoContextIndex.play(),this.GetCurrentClass(),this.GetCPClassLiveInfo(),this.GetVideoStatus();var a=t.getStorageSync("token");a||t.navigateTo({url:"/pages/login/login"});var s=setInterval((function(){null==e.$data.ClassroomLogId||""==e.$data.ClassroomLogId||void 0==e.$data.ClassroomLogId?(console.log("2223"),e.GetCurrentClass()):clearInterval(s)}),3e3);wx.onSocketMessage((function(t){try{var o=String(t.data).replace(recordString,"");if(o.indexOf("{}")>-1&&(o=o.replace("{}","")),0!=o.length){var a=JSON.parse(o);console.log("server return :",a),"M"in a&&a.M.length>0&&e.callMethods(a)}}catch(s){console.log("异常："+s),console.log("收到服务器内容："+t.data)}}))},onShow:function(){this.GetCurrentClass()}};e.default=u}).call(this,o("543d")["default"])},d483:function(t,e,o){"use strict";o.r(e);var a=o("9620"),s=o("4f3e");for(var n in s)"default"!==n&&function(t){o.d(e,t,(function(){return s[t]}))}(n);o("6e3e");var i,r=o("f0c5"),u=Object(r["a"])(s["default"],a["b"],a["c"],!1,null,"22673494",null,!1,a["a"],i);e["default"]=u.exports}},[["0b0c","common/runtime","common/vendor"]]]);